{% extends 'layout.html' %}
{% block style %}

<style>

.card {
    box-shadow: 0 2px 4px 0 rgba(0,0,0,0.2);
 
    
}

.card:hover, .card:focus , {
    box-shadow: 0 8px 16px 0 rgba(0,0,0,0.2); 
    transition: 0.8s;

}


</style>

{% endblock %}

{% block body %}
<div style="padding:30px;background-color: transparent;background: url('/static/sensor.png') fixed center no-repeat;">
  <h1 style="background-color: transparent;"> Welcome <small> {{session.Firstname}}</small></h1>
 <!--
  <hr>
-->
<br style="background-color: transparent;" > 
<div class="container" style="width:100%;" >
	<!-- Single button -->
<div class="row">
{% for Region in Regions %}
{% if Regions.index(Region)%2 == 0 %}  


{% for Reg in Region %}

<div class="card col-sm-3" style=" padding: 5px; margin:10px;background-color: transparent;"> 
 <img src="/static/motion-sensor.png" style="width:50%;opacity:0;" alt="">
<form action="" method="GET" style="padding: 5px" id="{{ Reg }}" name="{{ Reg }}" onsubmit="" >


<div class="btn-group" >
  <button type="button" class="btn btn-default dropdown-toggle btn-sm" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" onclick="saveRegion('{{ Reg }}')" style="width: 140px" > 

{{Reg}}
{% endfor %} 

<span class="caret"></span>
  </button>
	
  <ul class="dropdown-menu but2">
	{% set count = namespace(a=0) %}
    {% for R in Regions[Regions.index(Region)+1] %}
	
    <li>
	
	{% for r in R %}
	 {% if R.index(r)%2==0 %}
	<!--	<form action="" method=""> -->
		<div class="form-check" style="padding:5px; ">
  		{{ R[1] }}<input class="form-check-input pull-right" type="checkbox" value="{{ r }}" id="{{ r }}" name="{{ r }}" onclick="saveSensor('{{ r }}')" >
		{% else %}{% endif %}						
	{% endfor %}
		</div>
{% set count.a = count.a + 1 %}
	<!--	</form>  -->
</li>

<!--    <li role="separator" class="divider"></li>  -->
{% endfor %}
  </ul>
</div>	
<br>

<!--<button type="submit" class="btn btn-primary" >Add</button> -->
</form>
<!-- <input type="submit" value="Submit" class="btn btn-success ">
-->

</div>

{% else %}
{% endif %}	

{% endfor %}
</div>
<br>

<!--
<hr>  -->
<!--
  <table class="table table-striped">
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Region</th>
      <th>Status</th>
      <th>Select</th>
    </tr>
    {% for sensor in sensors %}
      <tr>
        <td>{{ sensor }}</td>
	
	<td>
		<div class="form-check">
  		<input class="form-check-input" type="checkbox" value="" 				id="defaultCheck1">
		</div>
		

	</td>
<!--        <td><a href="" class="btn btn-default pull-right">Edit</a></td>
        <td>
          <form action="" method="post">
            <input type="hidden" name="_method" value="DELETE">
            <input type="submit" value="Delete" class="btn btn-danger">
          </form>
        </td>  -->
  <!--    </tr>
    {% endfor %}
  </table>
-->
<!--
<hr>	
-->
<br>

<div id="successAlert" class="alert alert-success" role="alert" style="display:none;" >

<!--{% block div %}{% endblock %}	-->



</div>
<div id="errorAlert" class="alert alert-danger" role="alert" style="display:none;">



</div>

<!--
<hr>
-->
<br>
<div class="pull-right">	
	<!--  <hr> -->

             <!--   <input type="hidden" name="_method" value="DELETE"> -->
          <!--      <input type="submit" value="Submit" class="btn btn-success ">
		<a href="" class="btn btn-success btn-lg">Submit</a>  -->
		<button id="go" type="submit" class="btn btn-success" onclick="checkCheckbox()" >Go</button>
                	
<br>        <!--  <hr> -->
</div>

</div>
<br>
</div>
{% endblock %}

{% block script %}
<script>




var data=[];
var region=[''];
var R = '';
//var result=[];
var i=0;
//console.log(region.length);
	function saveRegion(Reg){
		
		R=Reg;
//		alert(R);	
//	if(region.indexOf(Reg)>0){

	//	}
	//	else{		
	//	region.push(Reg);
//		alert(region[i+1]);
	//	++i;}		
//		R = Reg;
	console.log(region.length);
		}
	function saveSensor(r){
//	alert(r);
   var checkBox = document.getElementById(r);
//	alert(checkBox.value);
	
    if (checkBox.checked == true){
//	region.push(R);	
// 	alert("checked");
	
//	console.log(region.indexOf(R));
	if(region.indexOf(R)>=0){
	console.log("region present");	
	}
	else{	
	
	region.push(R)
	}

	}
 	else{
//		region.push(R);
// 	alert("unchecked");
//		console.log("region not present");
//alert(region);
	}  }      
/*		
	$('#'+r).change(function(){
	if(this.checked){
		alert("checked");	
	}
	});
    } 

*/	



	
	

	function checkCheckbox(){
		result = [];
		if(region.length <=1){
			alert("Please select");
		}
/*		var unique = [];
		$.each(region, function(i, el){
    		if($.inArray(el, uniqueNames) === -1) uniqueNames.push(el);
		});

		for(var k = 0; k<unique.length();++k){
		
*/		console.log(region.length);
 		for(let k =1; k < region.length ;++k ){
		//alert(region[k]);
		$('#'+ region[k] + ' input[type="checkbox"]').each(function(){

			if($(this).is(":checked")){
				result.push( {"region": region[k], 
                    "type": this.value });

				data.push(this.value);
	//						alert(data);					
					
				
			
			}	
	
			});
		
			}
		

			output = []; 		
			for (let i =0; i < result.length; ++i) {
  				output.push(' '+result[i].region+' : '+result[i].type+' ');			
				console.log("...."+output[i]+".....");
				
/////////////////////////////////////////////////////////

value = []	
$.post( "/results", {
    data : output[i],
//    timeout: 200,
	
})
.done(function(data){
console.log(data);
value.push(data);
$('#errorAlert').text(value).show();
});

//setTimeout(function(){console.log("hold");},3000);

			

/////////////////AJAX TRY///////////////////////////////
/*				
				$.ajax({
					  type: 'POST',
					  url: '/results',
					  data: { 'data': R },
					  contentType: 'application/json;charset=UTF-8',
					})
				.done(function(data){
					if(data.error){
						$('#errorAlert').text(data.error).show();alert("here");
					}
					else {
						$('#errorAlert').text(data.message).show();
						}

				});
*/
///////////////////AJAX END////////////////////////////

				$('#successAlert').text(output).show();
			}
			//alert(output);
				
			
			//$('#successAlert').text(output).show();	
							
			console.log(result[0].region);
			console.log(output);
			delete output;
			delete result;
//			delete value;
			//console.log(output);
			//console.log(result);
	

	}
/*
$(document).ready(function(){
	$('#show').click(function(){
		$.ajax({
			data:{
				name: $('#')
			}		
			});		
		$.post("demo test",
		{
			name:"sensor",
			place:"swan"
		
		},
		function(data,status){
			alert("data: " + data + "\nStatus: " + status);
			$('#successAlert').text("success").show();
	
		}
		
		);
	});

});
9*/
//////////////////////////////////////////////////////////////
/*
$(document).ready(function() {

	$('#go').on('click', function(event) {

		$.ajax({
			data : result,
			type : 'POST',
			url : '/process'
		})
		.done(function(data) {

			if (data.error) {
				$('#errorAlert').text(data.error).show();
				$('#successAlert').hide();
			}
			else {
				$('#successAlert').text(data).show();
				$('#errorAlert').hide();
			}

		});

		event.preventDefault();

	});

});  */
/*
window.onload = function() {
	// setup the button click
	document.getElementById("go").onclick = function() {
		process()
	};
}
function process() {
	// ajax the JSON to the server
	$.post("process", result, function(){

	});
	// stop link reloading the page
 event.preventDefault();
}
*/
/////////////////////////////////////////////////////////////////
</script>
{% endblock %}


